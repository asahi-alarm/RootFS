{
  "ImageName" : "ArchLinux",
  "Guest_SHA256Sums" : "https://geo.mirror.pkgbuild.com/iso/latest/sha256sums.txt",
  "Guest_BaseURL" : "https://geo.mirror.pkgbuild.com/iso/latest/",
  "Guest_Image"   : "archlinux-bootstrap-x86_64.tar.zst",

  "Host_SHA256Sums" : "https://cloud-images.ubuntu.com/releases/focal/release/SHA256SUMS",
  "Host_BaseURL" : "https://cloud-images.ubuntu.com/releases/focal/release/",
  "Host_Image"   : "ubuntu-20.04-server-cloudimg-amd64.img",
  "QEmu" : "qemu-system-x86_64",
  "SkipPIGZ": "True",

  "PKGInstallCMD_CMT": [
    "The package command used to install packages"
  ],

  "PKGInstallCMD" : "/root/mega_install_packages.sh ",

  "PackagesToAdd_CMT": [
    "Which package names to install",
    "Package installation happens just after the `Commands_InChroot` step",
    "Package installation will install packages one by one",
    "Uses the PKGInstallCMD and iterates over the list individually"
  ],

  "PackagesToAdd" : [
    "sudo",
    "strace",
    "rsync",
    "lsb-release",
    "dbus",
    "lib32-dbus",
    "glibc",
    "lib32-glibc",
    "util-linux",
    "lib32-util-linux",
    "lm_sensors",
    "lib32-lm_sensors",
    "readline",
    "lib32-readline",
    "libelf",
    "lib32-libelf",
    "systemd",
    "lib32-systemd",
    "pulseaudio",
    "flac",
    "lib32-flac",
    "mesa-demos",
    "libatomic_ops",
    "xcb-util",
    "lib32-xcb-util",
    "xcb-util-keysyms",
    "lib32-xcb-util-keysyms",
    "libxcomposite",
    "lib32-libxcomposite",
    "libxinerama",
    "lib32-libxinerama",
    "libxss",
    "lib32-libxss",
    "libxtst",
    "lib32-libxtst",
    "libasyncns",
    "lib32-libasyncns",
    "at-spi2-core",
    "lib32-at-spi2-core",
    "cairo",
    "lib32-cairo",
    "gtk2",
    "lib32-gtk2",
    "gdk-pixbuf2",
    "lib32-gdk-pixbuf2",
    "gmp",
    "lib32-gmp",
    "kmod",
    "mpfr",
    "pango",
    "lib32-pango",
    "libgudev",
    "lib32-libgudev",
    "xcb-util-cursor",
    "xcb-util-errors",
    "xcb-util-image",
    "xcb-util-renderutil",
    "xcb-util-wm",
    "xcb-util-xrm",
    "xcb-imdkit",
    "libglvnd",
    "lib32-libglvnd",
    "spirv-llvm-translator",
    "lib32-spirv-llvm-translator",
    "spirv-tools",
    "lib32-spirv-tools",
    "glu",
    "lib32-glu",
    "libnm",
    "lib32-libnm",
    "mesa-utils",
    "lib32-mesa-utils",
    "libunwind",
    "lib32-libunwind",
    "sdl12-compat",
    "sdl2-compat",
    "sdl2",
    "lib32-sdl2",
    "lib32-sdl12-compat",
    "lib32-sdl2-compat",
    "sdl2_gfx",
    "sdl2_ttf",
    "lib32-sdl2_ttf",
    "sdl2_image",
    "lib32-sdl2_image",
    "sdl2_mixer",
    "lib32-sdl2_mixer",
    "sdl2_net",
    "libxslt",
    "lib32-libxslt",
    "zlib-ng",
    "freeglut",
    "lib32-freeglut",
    "libclc",
    "protobuf",
    "protobuf-c",
    "openal",
    "lib32-openal",
    "speex",
    "lib32-speex",
    "libvorbis",
    "lib32-libvorbis",
    "alsa-lib",
    "lib32-alsa-lib",
    "libpulse",
    "lib32-libpulse",
    "libsndfile",
    "lib32-libsndfile",
    "json-glib",
    "lib32-json-glib",
    "libtiff4",
    "lib32-libtiff4",
    "libtiff",
    "lib32-libtiff",
    "json-c",
    "lib32-json-c",
    "pcre2",
    "lib32-pcre2",
    "libffi",
    "lib32-libffi",
    "libpng",
    "lib32-libpng",
    "pixman",
    "lib32-pixman",
    "usbutils",
    "pciutils",
    "libpciaccess",
    "lib32-libpciaccess",
    "glew",
    "lib32-glew",
    "libxcb",
    "lib32-libxcb",
    "libxkbcommon-x11",
    "lib32-libxkbcommon-x11",
    "wayland",
    "lib32-wayland",
    "libx11",
    "lib32-libx11",
    "libxext",
    "lib32-libxext",
    "libxcursor",
    "lib32-libxcursor",
    "libxi",
    "lib32-libxi",
    "libxfixes",
    "lib32-libxfixes",
    "libidn2",
    "lib32-libidn2",
    "libxdamage",
    "lib32-libxdamage",
    "libxshmfence",
    "lib32-libxshmfence",
    "libxxf86vm",
    "lib32-libxxf86vm",
    "libxrandr",
    "lib32-libxrandr",
    "llvm-libs",
    "lib32-llvm-libs",
    "libva",
    "lib32-libva",
    "harfbuzz",
    "lib32-harfbuzz",
    "libvdpau",
    "lib32-libvdpau",
    "fuse2",
    "fuse3",
    "libibus",
    "mangohud",
    "lib32-mangohud",
    "libnss_nis",
    "nss",
    "lib32-nss",
    "nspr",
    "lib32-nspr",
    "gobject-introspection",
    "python",
    "openssl",
    "lib32-openssl",
    "curl",
    "lib32-curl",
    "xz",
    "lib32-xz",
    "xterm",
    "zenity",
    "xdg-desktop-portal",
    "xdg-desktop-portal-gtk",
    "wine",
    "vulkan-tools",
    "vulkan-icd-loader",
    "lib32-vulkan-icd-loader",
    "vulkan-headers",
    "pkgconf",
    "lib32-fontconfig",
    "ocl-icd",
    "lib32-ocl-icd",
    "audit",
    "avahi",
    "numactl",
    "sssd",
    "libldap",
    "lib32-libldap",
    "openldap",
    "openssl-1.1",
    "lib32-openssl-1.1",
    "gawk",
    "gdb",
    "krb5",
    "lib32-krb5",
    "pam",
    "lib32-pam",
    "sed",
    "base-devel",
    "git",
    "bzip2",
    "lib32-bzip2",
    "cdparanoia",
    "lib32-cdparanoia",
    "clang",
    "lib32-clang",
    "clang18",
    "colord",
    "lib32-colord",
    "libcups",
    "lib32-libcups",
    "cyrus-sasl",
    "elfutils",
    "libarchive",
    "lib32-libarchive",
    "expat",
    "lib32-expat",
    "gcc-libs",
    "lib32-gcc-libs",
    "libdrm",
    "lib32-libdrm",
    "argon2",
    "dbus-glib",
    "lib32-dbus-glib",
    "libgpg-error",
    "lib32-libgpg-error",
    "zlib",
    "lib32-zlib",
    "zstd",
    "lib32-zstd",
    "xorg-xauth",
    "xorg-xeyes",
    "libomxil-bellagio",
    "clinfo"
  ],

  "CopyFiles_Stage0_CMT": [
    "This stage copies files in to a temporary mount directory",
    "This ties in to the Stage1 to allow you to copy files from git repo to rootfs",
    "The filename here is the path relative to git repo base",
    "File is copied over to temp folder with same name"
  ],

  "CopyFiles_Stage0": [
    "arch_vulkan_pkgs/mesa-asahi-dummy-25.0.0_pre20241211-6-any.pkg.tar.xz",
    "Scripts/Arch/cleanup.sh",
    "Scripts/Arch/mega_install_packages.sh"
  ],

  "CopyFiles_Stage1_CMT": [
    "This copies the files from the stage0 mount location with to a location in the rootfs",
    "First argument is the filename to copy from the temp folder",
    "Second argument is the location inside the rootfs where to copy to"
  ],

  "CopyFiles_Stage1": [
    ["mesa-asahi-dummy-25.0.0_pre20241211-6-any.pkg.tar.xz", "root/"],
    ["cleanup.sh", "/"],
    ["mega_install_packages.sh", "root/"]
  ],

  "Commands_Stage1_0_CMT": [
    "This stage runs commands inside the qemu VM",
    "Allows you to install packages that the VM requires and the rootfs doesn't"
  ],

  "Commands_Stage1_0": [
    "export DEBIAN_FRONTEND=noninteractive",
    "apt-get update",
    "apt-get install -y coreutils pigz zstd"
  ],

  "RemoveFiles_Stage1_CMT": [
    "Removes files from the rootfs prior to chrooting",
    "Some files are preconfiguring in the rootfs and need to be changed"
  ],

  "RemoveFiles_Stage1": [
    "/etc/hosts",
    "/etc/resolv.conf"
  ],

  "Commands_Stage1_CMT": [
    "Executes commands in the VM prior to chrooting",
    "Necessary to set up mounts that the rootfs needs"
  ],

  "Commands_Stage1": [
    "chmod +w ./RootFS/root.x86_64/proc/",
    "chmod +w ./RootFS/root.x86_64/sys/",
    "mv ./RootFS/root.x86_64/* ./RootFS/",
    "rmdir ./RootFS/root.x86_64/",
    "export ROOTFS=./RootFS",
    "mount -t proc /proc $ROOTFS/proc/",
    "mount --rbind --make-rslave /sys $ROOTFS/sys/",
    "mount --rbind --make-rslave /dev $ROOTFS/dev/",
    "mount --rbind --make-rslave /dev/pts $ROOTFS/dev/pts/"
  ],

  "Commands_InChroot_CMT": [
    "Executes commands inside the rootfs prior to installing packages",
    "!!! After this step, packages are installed !!!"
  ],

  "Commands_InChroot": [
    "echo \"nameserver 8.8.8.8\" > /etc/resolv.conf",
    "echo \"US/Eastern\" > /etc/timezone",
    "ln -fs /usr/share/zoneinfo/America/New_York /etc/localtime",
    "chmod 1777 /tmp",
    "pacman-key --init",
    "pacman-key --populate",
    "sed -i 's/#Server = https:\\/\\/geo.mirror.pkgbuild.com\\/$repo\\/os\\/$arch\/Server = https:\\/\\/geo.mirror.pkgbuild.com\\/$repo\\/os\\/$arch\/' /etc/pacman.d/mirrorlist",
    "sed -i 's/CheckSpace/#CheckSpace/' /etc/pacman.conf",
    "sed -i 's/#ParallelDownloads = 5/ParallelDownloads = 20/' /etc/pacman.conf",
    "pacman --noconfirm -Syu",
    "pacman --noconfirm -S perl",
    "perl -0777 -pi -e 's/#\\[multilib\\]\\n#Include\/\\[multilib\\]\\nInclude\/igs' /etc/pacman.conf",
    "pacman --noconfirm -Syu",
    "pacman --noconfirm -U /root/mesa-asahi-dummy-25.0.0_pre20241211-6-any.pkg.tar.xz"
  ],

  "Commands_InChroot2_CMT": [
    "Executes commands inside the rootfs immediately following package installation"
  ],

  "Commands_InChroot2": [
    "pacman --noconfirm -S libc++",
    "useradd -m builduser",
    "echo \"builduser ALL=(ALL) NOPASSWD: ALL\" >> /etc/sudoers.d/builduser",
    "chmod 440 /etc/sudoers.d/builduser",
    "git clone https://aur.archlinux.org/yay-bin.git",
    "chmod 777 yay-bin",
    "cd yay-bin",
    "su builduser -c 'makepkg --noconfirm -si'",
    "cd ..",
    "rm -rf yay-bin",
    "yay --noconfirm -Syu",
    "su builduser -c 'yay --noconfirm -S libldap24'",
    "userdel -r builduser",
    "rm -f /etc/sudoers.d/builduser",
    "killall -3 gpg-agent",
    "rm -Rf /usr/local",
    "rm -Rf /root/*",
    "rm -Rf /root/.*",
    "find /sbin/ /bin/ /usr/bin/ -perm /4000 -delete",
    "find /sbin/ /bin/ /usr/bin/ -perm /2000 -delete",
    "pacman --noconfirm -R rust-bindgen sudo clang gcc rust",
    "pacman --noconfirm -Scc",
    "sed -i 's/#en_US.UTF-8 UTF-8/en_US.UTF-8 UTF-8/g' /etc/locale.gen",
    "locale-gen",
    "chmod +r /usr/lib/dbus-daemon-launch-helper"
  ],

  "Commands_Stage2_CMT": [
    "Executes commands in the VM after rootfs setup",
    "Required to tear down state inside the rootfs"
  ],

  "Commands_Stage2": [
    "export ROOTFS=./RootFS",
    "umount $ROOTFS/proc/",
    "umount -R $ROOTFS/sys/",
    "umount -R $ROOTFS/dev/pts/",
    "umount -R $ROOTFS/dev/",
    "rmdir $ROOTFS/proc",
    "rmdir $ROOTFS/dev/pts",
    "rmdir $ROOTFS/dev",
    "rmdir $ROOTFS/sys",
    "sh $ROOTFS/cleanup.sh",
    "rm $ROOTFS/cleanup.sh"
  ],

  "RemoveFiles_Stage2_CMT": [
    "Removes files from the rootfs post Stage2 teardown"
  ],

  "RemoveFiles_Stage2": [
  ],

  "RemoveDirs_Stage2": [
    "Whole folders to remove post Stage2 teardown.",
    "Uses rm -Rf to remove"
  ],

  "RemoveDirs_Stage2": [
  ],

  "Commands_Stage3": [
  ],

  "Commands_PreInstall": [
  ],

  "BinariesToInstall": [
  ]
}
